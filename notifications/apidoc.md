# Notifications API

Внутренние уведомления без пушей. Клиенты получают их через REST.

## Модель уведомления
- uid: UUID, публичный идентификатор
- text: текст уведомления
- type: generic | transaction
- expires_at: дата/время окончания жизни
- created_at: дата/время создания
- created_by_id: id создателя (менеджер/система)
  
Примечание: read/unread хранится и обрабатывается на стороне клиента.

## Поток создания
- Автоматически: при создании транзакции лояльности (/api/loyalty/transaction/create/) создаётся уведомление типа transaction для клиента. TTL по умолчанию 48 часов.
- Ручная рассылка менеджером: через /api/notifications/send/.

## Эндпоинты

### Список уведомлений
GET /api/notifications/

- Аутентификация: токен клиента.
- Возвращает только неистёкшие уведомления, адресованные этому пользователю.
 - Также это же поле возвращается в ответе `GET /api/client/info/` как `notifications` для уменьшения количества запросов.

Пример ответа:
```json
[
  {
    "uid": "e7f6a1b8-3c4f-4d12-9b1a-8a3f1b2c4d5e",
    "text": "Покупка проведена. Сумма: 250.00 сом. Начислено: 12 баллов. Списано: 0 баллов.",
    "type": "transaction",
    "expires_at": "2025-08-16T10:00:00Z",
    "created_at": "2025-08-15T10:00:00Z",
    "created_by_id": 42
  }
]
```

### Рассылка менеджером
POST /api/notifications/send/

- Только менеджер.

Вариант 1 — всем клиентам:
```json
{
  "text": "Завтра скидка 10%.",
  "type": "generic",
  "recipients_all": true,
  "ttl_hours": 48
}
```

Вариант 2 — выбранным пользователям:
```json
{
  "text": "Индивидуальное предложение",
  "type": "generic",
  "recipient_ids": [1, 2, 3],
  "expires_at": "2025-08-20T12:00:00Z"
}
```

Ответ 201 (пример):
```json
{
  "uid": "...",
  "text": "Завтра скидка 10%.",
  "type": "generic",
  "expires_at": "2025-08-17T12:00:00Z",
  "created_at": "2025-08-15T12:00:00Z",
  "created_by_id": 5
}
```

## Заметки
- Истечение: уведомления с expires_at <= now не возвращаются в списке.
- Read/unread ведётся на стороне клиента.
- Типы можно расширять.